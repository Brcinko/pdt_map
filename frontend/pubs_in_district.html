<!DOCTYPE html>
<html>
	<head>
		<title>Pubs</title>
		<script src='https://api.mapbox.com/mapbox-gl-js/v0.26.0/mapbox-gl.js'></script>
		<script src="http://code.jquery.com/jquery-3.1.1.min.js"></script>
		<link href='https://api.mapbox.com/mapbox-gl-js/v0.26.0/mapbox-gl.css' rel='stylesheet' />
		<link rel="stylesheet" href="http://www.w3schools.com/lib/w3.css">
	</head>
	<body>
			<header class="w3-container w3-teal">
				  <h1>Pubs and Restaurants</h1>
			</header>
			<nav class="w3-sidenav w3-white" style="width:25%">
	 			<a href="pubs">Pubs</a> 
	  			<a href="nearest_pub">Nearest Pub</a> 
	  			<a href="pubs_in_district">Pubs In City</a> 
	  			<a href="#">Coffe</a>
	  			<input type="submit" value="Set City" onClick="setCity()"> 
				<form>
	  				<input type="text" name="city" id="city" placeholder="City name.." style="margin: 2px">
				</form>
				 <div id="disc" class="discclass">
				    <select id="districts" class="districtsclass">
				    </select>
				 </div>
			</nav>
			<div style="margin-left:25%">

				<div id='map' style='width: 800px; height: 500px; border-style: groove; margin: 5px'></div>
                <pre id='coordinates' class='coordinates'></pre>
				<script>
					// get all distrcits to dropdown list
			        window.onload = function () { 
			        	getDistricts();
				    }


				    mapboxgl.accessToken = 'pk.eyJ1IjoiYnJjaW5rbyIsImEiOiJjaXU4czQyNTQwMDFhMnRweW05OGtyMHRpIn0.2-z96JNxFY23ERtAGz7iiA';
					var map = new mapboxgl.Map({
					    container: 'map',
					    center: [17.768399, 48.447811],
	  					zoom: 12,
					    style: 'mapbox://styles/mapbox/streets-v9'
					});
					// Add zoom and rotation controls to the map.
					map.addControl(new mapboxgl.NavigationControl());


					function getDistricts(){
						$.ajax({
	                        url : '/get_districts',
	                        type : 'GET',
	                        success: function(response) {
	                                console.log(response);
	                                var districts = JSON.parse(response);

	                                var box = document.getElementById("districts");
									districts.districts.forEach(function(item){
									    var opt = document.createElement("option");
									    //console.log(item);
									    opt.value = item
									    opt.innerHTML = item;
									    box.appendChild(opt);
									});
	                            },
	                        error: function(error) {
	                                console.log(error);
	                            }
						});						
					}





					function setCity(){
						console.log(document.getElementById("city").value);
						var call_data = "city=" + document.getElementById("city").value;
						var city_way = "";
						$.ajax({
	                        url : '/get_city_polygon',
	                        type : 'GET',
	                        data : call_data,
	                        //contentType: 'application/json; charset=utf-8',
	                        //dataType: 'json',
	                        success: function(response) {
	                                console.log(response);
	                                var geo = JSON.parse(response);
	                                console.log(JSON.stringify(geo[0].geometry.coordinates[0]));
	                    			map.fitBounds(geo[0].geometry.coordinates[0]);
	                    			city_way = JSON.stringify(geo[0].way);
	                    			displayPubs(city_way);
	                            },
	                        error: function(error) {
	                                console.log(error);
	                            }
						});
					}

					function displayPubs(city_way){
						var call_data = "city=" + city_way
						$.ajax({
	                        url : '/get_city_polygon',
	                        type : 'GET',
	                        data : call_data,
	                        //contentType: 'application/json; charset=utf-8',
	                        //dataType: 'json',
	                        success: function(response) {
	                                console.log(response);
	                                //var geo = JSON.parse(response);
	                                //console.log(JSON.stringify(geo[0].geometry.coordinates[0]));
	                            },
	                        error: function(error) {
	                                console.log(error);
	                            }
						});
					}


				</script>

			</div>

	</body>
</html>